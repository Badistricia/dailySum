# 群聊日报插件

一个能够自动总结群聊内容并生成精美日报的HoshinoBot插件。

## 功能特点

- 自动从HoshinoBot日志中提取群聊消息
- 使用AI（DeepSeek）生成群聊总结
- 生成精美的图片报告
- 支持定时总结和手动触发
- 可配置的总结时间和频率
- 详细的插件日志记录，便于排查问题

## 安装方法

1. 将本插件放置于HoshinoBot的`modules`目录下
2. 安装依赖:
```bash
pip install httpx pillow html2image
```
3. 修改`config.py`中的配置项
4. 重启HoshinoBot

## 配置说明

在`config.py`文件中，你需要配置以下内容:

1. `LOG_PATH`: 系统日志路径，HoshinoBot的日志文件
2. `AI_API_KEY`: DeepSeek API密钥
3. 定时任务配置: 
   - `ENABLE_SCHEDULER`: 是否启用定时任务
   - `SUMMARY_HOUR_AFTERNOON`: 下午总结时间（小时）
   - `SUMMARY_HOUR_NIGHT`: 晚上总结时间（小时）

## 使用方法

### 指令列表

- `日报`: 手动触发当天群聊总结
- `昨日日报`/`昨天日报`/`日报 昨天`: 手动触发昨天的群聊总结

### 定时任务

插件会根据配置，在指定时间自动生成群聊日报并发送到群里。

## 日志系统

插件内置了详细的日志记录系统，所有操作和错误都会被记录在`logs`目录下。日志文件按日期命名，格式为`dailysum_YYYY-MM-DD.log`。

日志记录了以下内容：
- 插件初始化和配置加载
- 日志解析过程和结果
- AI调用详情和结果
- 图片生成过程
- 发送消息状态
- 错误和异常信息

如果插件运行出现问题，请查看日志文件以获取详细的错误信息，这对于排查问题非常有帮助。

## 故障排除

为了帮助排查问题，插件提供了一个诊断工具。运行以下命令来检查插件的环境和配置：

```bash
cd path/to/HoshinoBot/hoshino/modules/dailySum
python3 _diagnostic.py
```

诊断工具会检查以下内容：
- 依赖模块是否已安装
- 必要的文件和目录是否存在
- 配置是否正确加载
- 日志系统是否正常工作

如果插件无法正常工作，请检查以下可能的问题：

1. **日志文件不存在或无法访问**：确保`LOG_PATH`配置正确，且有权限访问
2. **API密钥未设置或无效**：确保设置了有效的DeepSeek API密钥
3. **HTML2Image工具初始化失败**：检查是否安装了相关依赖，可能需要安装额外的系统库
4. **图片生成失败**：检查系统是否有足够的内存和磁盘空间
5. **发送消息失败**：检查机器人是否有权限发送图片消息

所有错误和详细的运行日志都会记录在`logs`目录下的日志文件中。

## 注意事项

1. 确保系统日志路径配置正确
2. 需要配置有效的DeepSeek API密钥
3. 生成图片需要一定的系统资源和时间，请耐心等待
4. 日志解析依赖于特定格式，如果日志格式变更，可能需要调整正则表达式
5. 插件会自动创建`data`和`logs`目录用于存储数据和日志

## 鸣谢

- [HoshinoBot](https://github.com/Ice-Cirno/HoshinoBot)
- [DeepSeek](https://deepseek.com) 